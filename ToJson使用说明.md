# ToJson è½¬æ¢å·¥å…·ä½¿ç”¨è¯´æ˜

## ğŸ“‹ åŠŸèƒ½è¯´æ˜

`ToJson.py` æ˜¯ä¸€ä¸ªé€šç”¨çš„ç…¤çŸ¿é‡‡ç©ºåŒºæ•°æ®é›†è½¬æ¢å·¥å…·ï¼Œèƒ½å¤Ÿï¼š

1. âœ… **è‡ªåŠ¨æ£€æµ‹ç…¤çŸ¿** - æ‰«æç›®å½•ä¸­çš„æ‰€æœ‰ç…¤çŸ¿CSVæ–‡ä»¶
2. âœ… **å•çŸ¿è½¬æ¢** - å°†ä¸€ä¸ªç…¤çŸ¿çš„10ä¸ªè¡¨åˆå¹¶ä¸º1ä¸ªJSONæ–‡ä»¶
3. âœ… **æ‰¹é‡è½¬æ¢** - è‡ªåŠ¨è½¬æ¢ç›®å½•ä¸­çš„æ‰€æœ‰ç…¤çŸ¿
4. âœ… **å®¹é”™å¤„ç†** - éƒ¨åˆ†è¡¨ç¼ºå¤±æ—¶ä»èƒ½æ­£å¸¸è½¬æ¢
5. âœ… **ç”ŸæˆæŠ¥å‘Š** - è‡ªåŠ¨ç”Ÿæˆè½¬æ¢æŠ¥å‘Š

---

## ğŸš€ å¿«é€Ÿå¼€å§‹
### ç›´æ¥è¿è¡Œ
https://hidden-hazards-converter.streamlit.app/
### å®‰è£…ä¾èµ–

```bash
pip install pandas
```

### ä½¿ç”¨æ–¹å¼

#### æ–¹å¼1: æ‰¹é‡è½¬æ¢ï¼ˆæ¨èï¼‰

```bash
# è‡ªåŠ¨æ£€æµ‹å¹¶è½¬æ¢å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ç…¤çŸ¿
python ToJson.py
```

**è¾“å‡º**:
```
ğŸš€ æ‰¹é‡è½¬æ¢æ¨¡å¼
ğŸ” è‡ªåŠ¨æ£€æµ‹åˆ° 1 ä¸ªç…¤çŸ¿: TESTç…¤çŸ¿

ğŸ“‹ æ­£åœ¨è½¬æ¢: TESTç…¤çŸ¿
  âœ… é‡‡ç©ºåŒºåŸºæœ¬ä¿¡æ¯: 30æ¡è®°å½•
  âœ… é‡‡ç©ºåŒºç§¯æ°´ä¿¡æ¯: 17æ¡è®°å½•
  âœ… é‡‡ç©ºåŒºç§¯æ°”ä¿¡æ¯: 124æ¡è®°å½•
  ...
âœ… å·²ç”Ÿæˆ: ./json_output/TESTç…¤çŸ¿-é‡‡ç©ºåŒºæ•°æ®é›†.json
```

#### æ–¹å¼2: è½¬æ¢å•ä¸ªç…¤çŸ¿

```bash
# è½¬æ¢æŒ‡å®šç…¤çŸ¿
python ToJson.py TESTç…¤çŸ¿
```

#### æ–¹å¼3: Pythonä»£ç è°ƒç”¨

```python
from ToJson import ToJson

# åˆ›å»ºè½¬æ¢å™¨
converter = ToJson(data_dir=".")

# è½¬æ¢å•ä¸ªç…¤çŸ¿
converter.convert_mine("TESTç…¤çŸ¿", "TESTç…¤çŸ¿-é‡‡ç©ºåŒºæ•°æ®é›†.json")

# æ‰¹é‡è½¬æ¢
converter.batch_convert(output_dir="./json_output")

# æŒ‡å®šç…¤çŸ¿åˆ—è¡¨
converter.batch_convert(
    mine_names=["TESTç…¤çŸ¿"],
    output_dir="./json_output"
)
```

---

## ğŸ“ æ–‡ä»¶ç»„ç»‡

### è¾“å…¥æ–‡ä»¶ï¼ˆCSVï¼‰

```
å½“å‰ç›®å½•/
â”œâ”€â”€ TESTç…¤çŸ¿-é‡‡ç©ºåŒºåŸºæœ¬ä¿¡æ¯.csv
â”œâ”€â”€ TESTç…¤çŸ¿-é‡‡ç©ºåŒºç§¯æ°´ä¿¡æ¯.csv
â”œâ”€â”€ TESTç…¤çŸ¿-é‡‡ç©ºåŒºç§¯æ°”ä¿¡æ¯.csv
â””â”€â”€ ...
```

### è¾“å‡ºæ–‡ä»¶ï¼ˆJSONï¼‰

```
json_output/
â”œâ”€â”€ TESTç…¤çŸ¿-é‡‡ç©ºåŒºæ•°æ®é›†.json
â””â”€â”€ è½¬æ¢æŠ¥å‘Š.txt
```

---

## ğŸ“Š è¾“å‡ºJSONæ ¼å¼

```json
{
  "mine_info": {
    "mine_id": "HX001",
    "mine_name": "TESTç…¤çŸ¿",
    "survey_date": "",
    "standard": "KAT 22.2-2024",
    "data_version": "1.0.0"
  },
  "statistics": {
    "goaf_basic_info": 30,
    "goaf_water_info": 17,
    "goaf_gas_info": 124,
    "fire_info": 0,
    "suspended_roof_info": 10,
    "collapse_info": 0,
    "crack_info": 10,
    "abandoned_shaft_info": 2,
    "seal_wall_info": 25,
    "treatment_info": 4
  },
  "data": {
    "goaf_basic_info": [...],
    "goaf_water_info": [...],
    "goaf_gas_info": [...],
    "fire_info": [],
    "suspended_roof_info": [...],
    "collapse_info": [],
    "crack_info": [...],
    "abandoned_shaft_info": [...],
    "seal_wall_info": [...],
    "treatment_info": [...]
  }
}
```

---

## âœ¨ ç‰¹è‰²åŠŸèƒ½

### 1. è‡ªåŠ¨æ£€æµ‹ç…¤çŸ¿

å·¥å…·ä¼šè‡ªåŠ¨æ‰«æç›®å½•ä¸­çš„CSVæ–‡ä»¶ï¼Œè¯†åˆ«æ‰€æœ‰ç…¤çŸ¿ï¼š

```python
converter = ToJson()
mines = converter.auto_detect_mines()
print(mines)  # ['TESTç…¤çŸ¿']
```

### 2. å®¹é”™å¤„ç†

- âœ… è¡¨æ–‡ä»¶ä¸å­˜åœ¨ â†’ è¯¥è¡¨è®°å½•ä¸ºç©ºæ•°ç»„
- âœ… è¡¨æ–‡ä»¶è¯»å–å¤±è´¥ â†’ è¯¥è¡¨è®°å½•ä¸ºç©ºæ•°ç»„ï¼Œè¾“å‡ºè­¦å‘Š
- âœ… éƒ¨åˆ†è¡¨ç¼ºå¤± â†’ ä»èƒ½ç”Ÿæˆå®Œæ•´JSONç»“æ„

**ç¤ºä¾‹**:
```
xxç…¤çŸ¿åªæœ‰5ä¸ªè¡¨ â†’ ç”Ÿæˆçš„JSONä¸­å…¶ä»–5ä¸ªè¡¨ä¸ºç©ºæ•°ç»„
```

### 3. è‡ªåŠ¨ç”Ÿæˆmine_id

å¦‚æœCSVä¸­æ²¡æœ‰mine_idå­—æ®µï¼Œå·¥å…·ä¼šè‡ªåŠ¨ç”Ÿæˆï¼š

```python
TESTç…¤çŸ¿ â†’ HXLBMK001
```

### 4. è¯¦ç»†çš„è½¬æ¢æŠ¥å‘Š

```
================================================================================
ç…¤çŸ¿é‡‡ç©ºåŒºæ•°æ®é›†æ‰¹é‡è½¬æ¢æŠ¥å‘Š
================================================================================

æ€»ç…¤çŸ¿æ•°: 3
æˆåŠŸ: 3
å¤±è´¥: 0
æ€»è®°å½•æ•°: 450

--------------------------------------------------------------------------------

âœ… TESTç…¤çŸ¿
   è®°å½•æ•°: 222
   è¡¨æ•°: 8/10
   æ–‡ä»¶: ./json_output/TESTç…¤çŸ¿-é‡‡ç©ºåŒºæ•°æ®é›†.json
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: æ–°ç…¤çŸ¿æ•°æ®è½¬æ¢

```bash
# 1. å‡†å¤‡CSVæ–‡ä»¶
æ–°ç…¤çŸ¿-é‡‡ç©ºåŒºåŸºæœ¬ä¿¡æ¯.csv
æ–°ç…¤çŸ¿-é‡‡ç©ºåŒºç§¯æ°´ä¿¡æ¯.csv
...

# 2. è¿è¡Œè½¬æ¢
python ToJson.py æ–°ç…¤çŸ¿

# 3. è·å¾—JSON
æ–°ç…¤çŸ¿-é‡‡ç©ºåŒºæ•°æ®é›†.json
```

### åœºæ™¯2: æ‰¹é‡è½¬æ¢å¤šä¸ªç…¤çŸ¿

```bash
# 1. å‡†å¤‡å¤šä¸ªç…¤çŸ¿çš„CSVæ–‡ä»¶
TESTç…¤çŸ¿-*.csv


# 2. æ‰¹é‡è½¬æ¢
python ToJson.py

# 3. è·å¾—å¤šä¸ªJSON
json_output/
â””â”€â”€  TESTç…¤çŸ¿-é‡‡ç©ºåŒºæ•°æ®é›†.json
```

### åœºæ™¯3: éƒ¨åˆ†è¡¨ç¼ºå¤±

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ–‡ä»¶å‘½åè§„èŒƒ

CSVæ–‡ä»¶å¿…é¡»éµå¾ªå‘½åè§„èŒƒï¼š

```
{ç…¤çŸ¿åç§°}-{è¡¨å}.csv

âœ… æ­£ç¡®:
- TESTç…¤çŸ¿-é‡‡ç©ºåŒºåŸºæœ¬ä¿¡æ¯.csv

âŒ é”™è¯¯:
- TESTç…¤çŸ¿_é‡‡ç©ºåŒºåŸºæœ¬ä¿¡æ¯.csv  (ä½¿ç”¨ä¸‹åˆ’çº¿)
```

### 2. ç¼–ç æ ¼å¼

CSVæ–‡ä»¶å¿…é¡»ä½¿ç”¨**UTF-8ç¼–ç **ï¼Œå¦åˆ™å¯èƒ½å‡ºç°ä¹±ç ã€‚

### 3. è¡¨åå¿…é¡»å®Œæ•´åŒ¹é…

è¡¨åå¿…é¡»ä¸Schemaå®šä¹‰çš„10ä¸ªè¡¨åå®Œå…¨ä¸€è‡´ï¼š

```
âœ… é‡‡ç©ºåŒºåŸºæœ¬ä¿¡æ¯
âœ… é‡‡ç©ºåŒºç§¯æ°´ä¿¡æ¯
âœ… é‡‡ç©ºåŒºç§¯æ°”ä¿¡æ¯
âœ… è‡ªç‡ƒå‘ç«ä¿¡æ¯
âœ… é‡‡ç©ºåŒºæ‚¬é¡¶ä¿¡æ¯
âœ… é‡‡ç©ºåŒºå¡Œé™·ä¿¡æ¯
âœ… åœ°è£‚ç¼ä¿¡æ¯
âœ… åºŸå¼ƒäº•ç­’ä¿¡æ¯
âœ… å¯†é—­å¢™ä¿¡æ¯
âœ… é‡‡ç©ºåŒºæ²»ç†ä¿¡æ¯
```

---

## ğŸ”§ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰è¾“å‡ºç›®å½•

```python
converter = ToJson(data_dir="./csv_data")
converter.batch_convert(output_dir="./my_json_output")
```

### åªè½¬æ¢æŒ‡å®šç…¤çŸ¿

```python
converter = ToJson()
converter.batch_convert(
    mine_names=["TESTç…¤çŸ¿"],
    output_dir="./json_output"
)
```

### è·å–è½¬æ¢ç»“æœ

```python
results = converter.batch_convert()

for result in results:
    if result['success']:
        print(f"{result['mine_name']}: {result['record_count']}æ¡è®°å½•")
    else:
        print(f"{result['mine_name']}: å¤±è´¥ - {result['error']}")
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **Schemaå®šä¹‰**: ç…¤çŸ¿é‡‡ç©ºåŒºæ™®æŸ¥æ•°æ®é›†Schema.json
- **JSONæ ¼å¼è¯´æ˜**: JSONæ ¼å¼è§„èŒƒ-å¤§æ¨¡å‹è®­ç»ƒç‰ˆ.md
- **å•ä½è§„èŒƒ**: å•ä½è§„èŒƒè¯´æ˜.md

---

**ç‰ˆæœ¬**: 1.0.0  
**æ›´æ–°æ—¥æœŸ**: 2024-12-26  
**ç»´æŠ¤å•ä½**: ç…¤çŸ¿é‡‡ç©ºåŒºæ™®æŸ¥æ•°æ®æ ‡å‡†åŒ–å·¥ä½œç»„

